<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EcoS Prompt-Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
  <div class="max-w-3xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4">EcoS Prompt-Generator</h1>
    <p class="mb-6 text-sm text-gray-700">
      <strong>Instructions:</strong><br>
      Select the current phase of your research project, fill in the fields, then click “Submit” to generate your prompt.<br>
      You can then copy the prompt and paste it into ChatGPT, Claude, Gemini, etc.
    </p>

    <div class="space-y-6">
      <!-- Mode selector -->
      <div>
        <label for="modeSelect" class="block font-medium mb-1">Choose what to generate:</label>
        <select id="modeSelect"
                class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="rq">1. Topic &amp; Research Question</option>
          <option value="relevance">2. Relevance Table</option>
          <option value="lit-structure">3. Literature Review Structure</option>
          <option value="literature-review">4. Literature Review</option>
          <option value="analytical-framework">5. Analytical Framework</option>
        </select>
      </div>

      <!-- 1. Topic & Research Question -->
      <div id="rq-section" class="space-y-4">
        <div>
          <label class="block font-medium">Title of the Thesis</label>
          <input id="title" type="text" maxlength="500" required
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="title-count" class="text-right text-xs text-gray-500">0 / 500</div>
        </div>
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="research-question" type="text" maxlength="500" required
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="rq-count" class="text-right text-xs text-gray-500">0 / 500</div>
        </div>
      </div>

      <!-- 2. Relevance Table -->
      <div id="relevance-section" class="space-y-4 hidden">
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="relevance-rq" type="text" maxlength="500" required
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="relevance-rq-count" class="text-right text-xs text-gray-500">0 / 500</div>
        </div>
        <div>
          <label class="block font-medium">Relevance Section</label>
          <textarea id="relevance" rows="6" maxlength="50000" required
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="relevance-count" class="text-right text-xs text-gray-500">0 / 50000</div>
        </div>
      </div>

      <!-- 3. Literature Review Structure -->
      <div id="lit-structure-section" class="space-y-4 hidden">
        <!-- Research Question for this mode -->
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="lit-structure-rq" type="text" maxlength="500" required
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="lit-structure-rq-count" class="text-right text-xs text-gray-500">0 / 500</div>
        </div>
        <!-- Dynamic issues container -->
        <div id="lit-structure-issues" class="space-y-6"></div>
        <button id="add-issue-btn" type="button"
                class="bg-gray-200 text-gray-800 px-4 py-2 rounded-xl hover:bg-gray-300 transition">
          + Add another issue
        </button>
      </div>

      <!-- 4. Literature Review -->
      <div id="literature-review-section" class="space-y-4 hidden">
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="literature-review-rq" type="text" maxlength="500" required
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="literature-review-rq-count" class="text-right text-xs text-gray-500">0 / 500</div>
        </div>
        <div>
          <label class="block font-medium">Literature Review Structure</label>
          <textarea id="literature-review-structure" rows="4" maxlength="50000" required
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="literature-review-structure-count" class="text-right text-xs text-gray-500">0 / 50000</div>
        </div>
        <div>
          <label class="block font-medium">Literature Review</label>
          <textarea id="literature-review" rows="6" maxlength="50000" required
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="literature-review-count" class="text-right text-xs text-gray-500">0 / 50000</div>
        </div>
      </div>

      <!-- 5. Analytical Framework -->
      <div id="analytical-framework-section" class="space-y-4 hidden">
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="analytical-framework-rq" type="text" maxlength="500" required
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="analytical-framework-rq-count" class="text-right text-xs text-gray-500">0 / 500</div>
        </div>
        <div>
          <label class="block font-medium">Literature Review</label>
          <textarea id="analytical-framework-lit-review" rows="4" maxlength="50000" required
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="analytical-framework-lit-review-count" class="text-right text-xs text-gray-500">0 / 50000</div>
        </div>
        <div>
          <label class="block font-medium">Analytical Framework</label>
          <textarea id="analytical-framework" rows="6" maxlength="50000" required
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="analytical-framework-count" class="text-right text-xs text-gray-500">0 / 50000</div>
        </div>
      </div>

      <!-- Submit -->
      <button id="submit-btn"
              class="w-full bg-blue-600 text-white px-5 py-2 rounded-xl shadow hover:bg-blue-700 transition">
        Submit
      </button>
    </div>

    <!-- Output & Copy -->
    <div id="result" class="mt-8 whitespace-pre-wrap bg-white border border-gray-300 rounded-xl p-4 text-sm"></div>
    <button id="copy-btn"
            class="mt-4 w-full bg-green-600 text-white px-5 py-2 rounded-xl shadow hover:bg-green-700 transition hidden">
      Copy to Clipboard
    </button>
  </div>

  <script>
    // Cache
    const modeSelect  = document.getElementById('modeSelect');
    const resultDiv   = document.getElementById('result');
    const copyBtn     = document.getElementById('copy-btn');
    const issuesDiv   = document.getElementById('lit-structure-issues');
    let issueCount    = 0;

    // Sections mapping
    const sections = {
      rq:                  document.getElementById('rq-section'),
      relevance:           document.getElementById('relevance-section'),
      'lit-structure':     document.getElementById('lit-structure-section'),
      'literature-review': document.getElementById('literature-review-section'),
      'analytical-framework': document.getElementById('analytical-framework-section')
    };

    function updateSections() {
      Object.entries(sections).forEach(([k, el]) => {
        el.classList.toggle('hidden', modeSelect.value !== k);
      });
      resultDiv.textContent = '';
      copyBtn.classList.add('hidden');
    }
    modeSelect.addEventListener('change', updateSections);
    updateSections();

    // Character counter helper
    function setupCounter(el, countEl, maxLen) {
      el.addEventListener('input', () => {
        countEl.textContent = `${el.value.length} / ${maxLen}`;
      });
    }

    // Add issue block
    function addIssue() {
      issueCount++;
      const wrapper = document.createElement('div');
      wrapper.className = 'space-y-2 border-t pt-4 relative';
      wrapper.dataset.issue = issueCount;

      // Delete button
      const delBtn = document.createElement('button');
      delBtn.type    = 'button';
      delBtn.textContent = '–';
      delBtn.title  = 'Remove this issue';
      delBtn.className = 'absolute top-0 right-0 bg-red-200 text-red-800 px-2 rounded-full hover:bg-red-300';
      delBtn.addEventListener('click', () => {
        if (issuesDiv.children.length > 3) {
          wrapper.remove();
          updateDeleteButtons();
        }
      });
      wrapper.appendChild(delBtn);

      // Title
      const titleLabel = document.createElement('label');
      titleLabel.className = 'block font-medium';
      titleLabel.textContent = `Issue ${issueCount}: Title`;
      const titleInput = document.createElement('input');
      titleInput.type = 'text';
      titleInput.maxLength = 500;
      titleInput.required = true;
      titleInput.className = 'w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500';
      const titleCount = document.createElement('div');
      titleCount.className = 'text-right text-xs text-gray-500';
      titleCount.textContent = '0 / 500';
      setupCounter(titleInput, titleCount, 500);

      // Explanation
      const explLabel = document.createElement('label');
      explLabel.className = 'block font-medium';
      explLabel.textContent = `Issue ${issueCount}: Explanation / Purpose`;
      const explInput = document.createElement('textarea');
      explInput.rows = 4;
      explInput.maxLength = 5000;
      explInput.required = true;
      explInput.className = 'w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500';
      const explCount = document.createElement('div');
      explCount.className = 'text-right text-xs text-gray-500';
      explCount.textContent = '0 / 5000';
      setupCounter(explInput, explCount, 5000);

      // Append all
      wrapper.append(titleLabel, titleInput, titleCount, explLabel, explInput, explCount);
      issuesDiv.append(wrapper);
      updateDeleteButtons();
    }

    function updateDeleteButtons() {
      Array.from(issuesDiv.children).forEach(w => {
        const btn = w.querySelector('button');
        btn.style.visibility = (issuesDiv.children.length <= 3 ? 'hidden' : 'visible');
      });
    }

    // Initialize default 3 issues
    for (let i = 0; i < 3; i++) addIssue();
    document.getElementById('add-issue-btn').addEventListener('click', addIssue);

    // Generate & show
    document.getElementById('submit-btn').addEventListener('click', () => {
      let prompt = '';
      const mode = modeSelect.value;

      if (mode === 'rq') {
        const t = document.getElementById('title').value.trim();
        const q = document.getElementById('research-question').value.trim();
        prompt = `EcoS Prompt-Generator: Research Question\n\nTitle: "${t}"\nResearch Question: "${q}"`;
      } 
      else if (mode === 'relevance') {
        const q = document.getElementById('relevance-rq').value.trim();
        const r = document.getElementById('relevance').value.trim();
        prompt = `EcoS Prompt-Generator: Relevance\n\nResearch Question: "${q}"\n\nRelevance Section:\n${r}`;
      } 
      else if (mode === 'lit-structure') {
        const rq = document.getElementById('lit-structure-rq').value.trim();
        const lines = Array.from(issuesDiv.children).map(w => {
          const title = w.querySelector('input').value.trim();
          const expl  = w.querySelector('textarea').value.trim();
          return `Issue: ${title}\nExplanation / Purpose: ${expl}`;
        }).join('\n\n');
        prompt = `<PromptTemplate>
<!-- ===== ROLE ===== -->
<Role>
    You are acting as the professor’s assistant.
    Your sole job is to analyse students’ proposed **Literature Review Structures (LRS)** and give them feedback *before* they submit to the professor.
</Role>

<!-- ===== PURPOSE ===== -->
<Background>
    The **Literature Review Structure (LRS)** is a planning tool.
    It helps students identify the conceptual fields, debates, and analytical tools they will need to review in the full Literature Review (LR).
    The LR will be a **systematic review of existing scholarly work**, used to build a foundation for the student's own **Analytical Framework (AF)**.
    The AF will be derived from the literature review and represent the student's own method for answering their research question in the empirical chapter.
</Background>

<!-- ===== INSTRUCTIONS ===== -->
<Instructions>
    1. Judge each LRS section only on whether it contributes directly to answering the **key analytical term** in the Research Question (RQ).
    2. The LRS should prepare the *how* (concepts, typologies, frameworks)—**not** the *why* (causes, drivers) or *what* (cases, results).
    3. If a section drifts into causal explanations, history, cases, or results, label it **Off-target**.
    4. Definitions are allowed only if concise (≤2–3 sentences); otherwise label **Adapt**.
    5. Keep tone supportive but academically precise; remind student professor has final say.
</Instructions>

<!-- ===== TAGS ===== -->
<Tags>
    ✅ On-target – supports the key analytical term.  
    ⚠️ Off-target – should be cut or moved.  
    🛠️ Adapt – needs refocusing or shortening.  
    🧩 Suggestion – optional improvement.
</Tags>

<!-- ===== EXPECTED OUTPUT ===== -->
<ExpectedOutput>
    For **each** LRS section:
    • Tag + one-sentence verdict + 1–3 sentence justification + reminder professor decides.
</ExpectedOutput>

<!-- ===== REVIEW CRITERIA ===== -->
<ReviewCriteria>
    1. Addresses the RQ’s key analytical term?  
    2. Avoids causal, historical, or case-specific content?  
    3. Thematically organized (not timeline/author)?  
    4. Shows synthesis (not summary)?  
    5. Builds toward an AF for empirical work?
</ReviewCriteria>

<!-- ===== STUDENT INPUT ===== -->
<ResearchQuestion>
    ${rq}
</ResearchQuestion>

<LiteratureReview>
${lines.split('\n').map(l=>'    '+l).join('\n')}
</LiteratureReview>
</PromptTemplate>`;
      } 
      else if (mode === 'literature-review') {
        const q = document.getElementById('literature-review-rq').value.trim();
        const s = document.getElementById('literature-review-structure').value.trim();
        const r = document.getElementById('literature-review').value.trim();
        prompt = `EcoS Prompt-Generator: Literature Review\n\nResearch Question: "${q}"\n\nStructure:\n${s}\n\nReview:\n${r}`;
      } 
      else if (mode === 'analytical-framework') {
        const q  = document.getElementById('analytical-framework-rq').value.trim();
        const lr = document.getElementById('analytical-framework-lit-review').value.trim();
        const af = document.getElementById('analytical-framework').value.trim();
        prompt = `EcoS Prompt-Generator: Analytical Framework\n\nResearch Question: "${q}"\n\nLiterature Review:\n${lr}\n\nAnalytical Framework:\n${af}`;
      }
      resultDiv.textContent = prompt;
      copyBtn.classList.remove('hidden');
    });

    // Copy to clipboard
    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(resultDiv.textContent)
        .then(() => copyBtn.textContent = 'Copied!')
        .catch(() => copyBtn.textContent = 'Copy Failed');
    });
  </script>
</body>
</html>
