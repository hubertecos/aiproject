<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EcoS AI Prompt-Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
  <div class="max-w-3xl mx-auto p-6 space-y-6">

    <h1 class="text-3xl font-bold">EcoS AI Prompt-Generator</h1>
    <p class="mb-3 text-sm text-gray-700">
      <strong>Instructions:</strong><br>
      Select the current phase of your research project, fill in the fields, then click “Generate Prompt” to generate your prompt.<br>
      You can then copy the prompt and paste it into ChatGPT, Claude, Gemini, etc.
    </p>
    <button id="info-btn" type="button" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-xl hover:bg-gray-300">Why We Built This Tool (And How You Should Use It)</button>

    <!-- Single dropdown with Testing option -->
    <div>
      <label for="modeSelect" class="block font-medium mb-1">What to generate</label>
      <select id="modeSelect"
              class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500">
        <option value="rq">1. Topic &amp; Research Question</option>
        <option value="relevance">2. Relevance of the Research Question</option>
        <option value="lit-structure">3. Literature Review Structure</option>
        <option value="literature-review">4. Literature Review</option>
        <option value="analytical-framework">5. Analytical Framework</option>
        <option value="formal-aspects">6. Formal Aspects</option>
      </select>
    </div>

    <!-- Official: RQ -->
    <div id="rq-section" class="space-y-4 hidden">
      <div>
        <label class="block font-medium">Project Type</label>
        <div class="space-y-1 ml-4">
          <label class="block"><input type="radio" name="project-type" value="thesis" class="mr-1" checked>Master's thesis</label>
          <label class="block"><input type="radio" name="project-type" value="term" class="mr-1">Term paper</label>
        </div>
      </div>
      <div>
        <label id="title-label" class="block font-medium">Title of the Thesis</label>
        <input id="title" type="text" maxlength="500"
               class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
        <div id="title-count" class="text-xs text-gray-500">0 / 500</div>
      </div>
      <div>
        <label class="block font-medium">Research Question</label>
        <input id="research-question" type="text" maxlength="500"
               class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
        <div id="rq-count" class="text-xs text-gray-500">0 / 500</div>
      </div>
    </div>

    <!-- Official: Relevance -->
    <div id="relevance-section" class="space-y-4 hidden">
      <div>
        <label class="block font-medium">Research Question</label>
        <input id="relevance-rq" type="text" maxlength="500"
               class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
        <div id="relevance-rq-count" class="text-xs text-gray-500">0 / 500</div>
      </div>
      <div id="relevance-stakeholders" class="space-y-6"></div>
      <div class="flex gap-2">
        <button id="add-stakeholder-btn" type="button"
                class="flex-1 bg-gray-200 p-2 rounded-xl hover:bg-gray-300">+ Add stakeholder</button>
        <button id="remove-stakeholder-btn" type="button"
                class="flex-1 bg-red-200 p-2 rounded-xl hover:bg-red-300 hidden">– Remove last stakeholder</button>
      </div>
    </div>

    <!-- 3. Official Literature Review Structure -->
    <div id="lit-structure-section" class="space-y-4 hidden">
      <div>
        <label class="block font-medium">Research Question</label>
        <input id="lit-structure-rq" type="text" maxlength="500"
               class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
        <div id="lit-structure-rq-count" class="text-xs text-gray-500">0 / 500</div>
      </div>
      <div id="lit-structure-issues" class="space-y-6"></div>
      <div class="flex gap-2">
        <button id="add-issue-btn" type="button"
                class="flex-1 bg-gray-200 p-2 rounded-xl hover:bg-gray-300">+ Add issue</button>
        <button id="remove-issue-btn" type="button"
                class="flex-1 bg-red-200 p-2 rounded-xl hover:bg-red-300 hidden">– Remove last issue</button>
      </div>
    </div>


    <!-- Official: Literature Review -->
    <div id="literature-review-section" class="space-y-4 hidden">
      <div>
        <label class="block font-medium">Research Question</label>
        <input id="literature-review-rq" type="text" maxlength="500"
               class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
        <div id="literature-review-rq-count" class="text-xs text-gray-500">0 / 500</div>
      </div>
      <div>
        <label class="block font-medium">Provide Literature Review</label>
        <div class="space-y-1 ml-4">
          <label class="block"><input type="radio" name="lr-input-mode" value="text" class="mr-1" checked>Paste text into the form</label>
          <label class="block"><input type="radio" name="lr-input-mode" value="file" class="mr-1">Upload document to AI later</label>
        </div>
      </div>
      <div id="literature-review-textfields" class="space-y-2">
        <label class="block font-medium">Literature Review</label>
        <textarea id="literature-review" rows="6" maxlength="50000"
                  class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
        <div id="literature-review-count" class="text-xs text-gray-500">0 / 50000</div>
      </div>
      <div id="literature-review-file-reminder" class="hidden text-sm bg-blue-100 text-blue-700 p-2 rounded">
        When using the AI, upload your Literature Review file together with this prompt.
      </div>
    </div>

    <!-- Official: Analytical Framework -->
    <div id="analytical-framework-section" class="space-y-4 hidden">
      <div>
        <label class="block font-medium">Research Question</label>
        <input id="analytical-framework-rq" type="text" maxlength="500"
               class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
        <div id="analytical-framework-rq-count" class="text-xs text-gray-500">0 / 500</div>
      </div>
      <div>
        <label class="block font-medium">Provide Literature Review and Analytical Framework</label>
        <div class="space-y-1 ml-4">
          <label class="block"><input type="radio" name="af-input-mode" value="text" class="mr-1" checked>Paste text into the form</label>
          <label class="block"><input type="radio" name="af-input-mode" value="file" class="mr-1">Upload document to AI later</label>
        </div>
      </div>
      <div id="analytical-framework-textfields" class="space-y-2">
        <label class="block font-medium">Literature Review</label>
        <textarea id="analytical-framework-lit-review" rows="4" maxlength="50000"
                  class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
        <div id="analytical-framework-lit-review-count" class="text-xs text-gray-500">0 / 50000</div>
        <label class="block font-medium">Analytical Framework</label>
        <textarea id="analytical-framework" rows="6" maxlength="50000"
                  class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
        <div id="analytical-framework-count" class="text-xs text-gray-500">0 / 50000</div>
      </div>
      <div id="analytical-framework-file-reminder" class="hidden text-sm bg-blue-100 text-blue-700 p-2 rounded">
        When using the AI, upload both your Literature Review and Analytical Framework files together with this prompt.
      </div>
    </div>

    <!-- Formal Aspects -->
    <div id="formal-aspects-section" class="space-y-4 hidden">
      <p class="text-sm">
        Use this prompt to have the AI check your theoretical submission for formal formatting. After generating the prompt, paste it into the AI and upload your text, PDF, or Word file. For privacy you may remove your cover page before uploading, but your final submission must include a cover page with all required information.
      </p>
    </div>

    <!-- Generate Prompt & Output -->
    <div class="space-y-4">
      <button id="submit-btn" class="w-full bg-blue-600 text-white p-3 rounded-xl hover:bg-blue-700 transition">Generate Prompt</button>
      <button id="copy-btn" class="w-full bg-green-600 text-white p-3 rounded-xl hover:bg-green-700 transition hidden">Copy Prompt to Clipboard</button>
      <div id="status-msg" class="text-center text-red-600 text-sm font-medium hidden">New prompt generated!</div>
      <div id="result" class="whitespace-pre-wrap bg-white p-4 border border-gray-300 rounded-xl text-sm hidden"></div>
    </div>

  </div>

  <!-- Info Overlay -->
  <div id="info-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-6 rounded-xl max-w-3xl max-h-[90vh] overflow-y-auto relative space-y-4">
      <button id="info-close" type="button" class="absolute top-2 right-2 text-gray-600 text-xl">&times;</button>
      <h1 class="text-2xl font-bold">Why We Built This Tool (And How You Should Use It)</h1>
      <h2 class="text-xl font-semibold mt-4">Our Intentions</h2>
      <p>We embarked on developing this AI-powered feedback tool in summer semester 2025, recognizing the transformative potential of artificial intelligence in academic contexts. Throughout the development process, we realized that given the unprecedented pace at which AI technology continues to evolve, creating specialized prompts would be the most future-proof and versatile approach—allowing you to leverage any AI model that emerges while ensuring the feedback consistently reflects our program's research methodology and standards.</p>
      <p>After extensive testing and refinement, we developed prompts that encode how we approach research design and structure in our program. This wasn't merely about identifying potential issues, but about harnessing the opportunities that AI's emergence presents for academic support. We wanted to create something accessible for all EcoS students—whether you're experienced with AI tools or encountering them for the first time. The system we built is simple to use and fundamentally equitable, giving every student the same foundation for leveraging AI's potential in developing their research projects at EcoS.</p>
      <p>Our goal was to help students understand how the research methodology and standards at EcoS apply to their individual work and maximize their consultation time with professors by ensuring discussions can focus on the substantive, nuanced aspects of research that require genuine understanding and experience. But we also knew from the beginning that what we were creating wouldn't be perfect—and that understanding its limitations would be just as important as understanding its capabilities.</p>

      <h2 class="text-xl font-semibold mt-4">What We Learned About AI (And What It Means for This Tool)</h2>
      <p>Developing this tool taught us interesting insights about how large language models (LLMs) actually operate. When you test your research question or literature review structure, you're not consulting a knowledgeable expert—you're engaging with a system that generates text based on patterns gleaned from massive amounts of training data. The AI responds to the detailed prompts we've created, which specify exactly what to look for and how to evaluate your work according to our program's standards.</p>
      <p>This led us to develop a key understanding foundational for this project and beyond: despite having access to enormous amounts of information through its training data, AI doesn't actually "know" anything in the way we humans do. When you ask an AI chatbot whether there's sufficient literature on your research topic, it might confidently respond "yes"—but that judgment isn't based on systematically scanning academic databases or carefully evaluating research gaps the way a real researcher would. Instead, it's making a probability-based prediction about what response seems most likely, because it's designed to provide you with an answer.</p>
      <p>We crafted our prompts to channel this pattern-matching capability toward evaluating your work against our program's requirements, creating a system that delivers informative, user-friendly feedback to help you understand how your research aligns with our standards. Think of it as sophisticated quality control—but with important limitations.</p>
      <p>Even with these carefully crafted prompts, different AI tools can provide varying assessments of identical work. Perhaps more surprisingly, the same AI tool can also generate different feedback if you simply start a new chat session and resubmit the same content, because it performs fresh probability calculations each time. This isn't a system flaw—it's how these technologies fundamentally operate. As users of this technology, we cannot create perfect AI that provides ideal solutions consistently, but we can optimize our approach to extract the best possible results from the tools available to us.</p>

      <h2 class="text-xl font-semibold mt-4">How We Think You Should Approach This</h2>
      <p><strong>Start early in your development process.</strong> This isn't designed as a last-minute submission check. If you discover an hour before the deadline that your approach needs fundamental revision, you won't have adequate time to address the issues properly. Even if you simply submit an AI-generated version at the last minute, that completely misses the point—this is <em>your</em> research project, and the goal isn't merely to produce output, but to develop your own understanding and expertise about a topic you're genuinely interested in examining.</p>
      <p><strong>Engage your critical thinking.</strong> The AI isn't perfect, and you shouldn't simply accept or reject its feedback without careful consideration. Instead, use it as a stimulus to better understand and critically examine your own work. Remember, what you develop during the theoretical part of your thesis becomes the foundation for the empirical and analytical sections where you actually answer your research question. That's precisely why <em>you yourself</em> need to thoroughly understand what you're writing about, not the AI. The value lies in the reflection process the feedback encourages, not in the AI's specific conclusions.</p>
      <p><strong>Use it to prepare for professor consultations.</strong> In academia, the time you have with supervisors during research development is invaluable—they bring expertise and experience from supervising countless research projects, understanding common challenges and offering guidance derived from years in the field. When your work already meets basic requirements and demonstrates that your project is manageable, you can dedicate consultation time with professors to discussing theoretical nuances, methodological considerations, and other sophisticated aspects of research. This requires you to genuinely understand your topic and engage meaningfully with the feedback you've received.</p>
      <p><strong>Take advantage of AI's broader capabilities.</strong> Beyond generating quality control assessments of your submissions, AI can help you better understand program requirements as well as various aspects of your chosen topic. If, for instance, you don't understand why research questions implying causality can be problematic, you can simply request an explanation. You can also ask follow-up questions about the AI's comments regarding your specific topic. While AI might not always provide perfectly relevant insights for your research area, it can help clarify concepts to deepen your understanding of the subject matter. Additionally, if English isn't your native language, you can engage with AI in your preferred language or request translations and clarifications. At EcoS we use English as our common language, but that doesn't preclude seeking understanding in whatever way works best for you.</p>

      <h2 class="text-xl font-semibold mt-4">Understanding the Boundaries</h2>
      <p>While this tool offers valuable support, it's important to understand what it cannot replace. Your professors will still expect you to demonstrate deep understanding of your research topic—in consultation meetings, class presentations, and ultimately during your thesis defense. The goal of this tool isn't to perform the intellectual work for you, but to help ensure you're developing that understanding effectively.</p>
      <p>Over-reliance on AI feedback can actually undermine the fundamental learning objectives that cultivate critical thinking and analytical skills essential for any thoughtful professional, regardless of your future path. That's why we believe it's essential to understand that artificial intelligence fundamentally cannot replicate human judgment because of how it operates—through statistical predictions and pattern matching rather than genuine understanding and contextual reasoning.</p>
      <p>That said, AI does possess certain strengths. As mentioned previously, you can leverage its capabilities and extensive training data to enhance your understanding of your research topic. AI has access to more background information across a vast range of topics than any individual professor could possess—no one can be an expert in every possible research area. But it's equally important to remember its significant limitations: it cannot assess whether your theoretical framework truly suits your research context or whether your methodology will actually prove effective in practice.</p>
      <p>Remember that the feedback you receive comes from an AI system designed to improve your understanding of academic work, not to provide authoritative academic judgment. When you meet with professors, focus on engaging with the substance of your research rather than reporting what "AI said" about your work. Professors are there to guide your intellectual development and supervise your research project, not to validate AI assessments.</p>

      <h2 class="text-xl font-semibold mt-4">Why This Matters for Your Future</h2>
      <p>Our experience building this tool has shown us that this represents merely the beginning. The emergence of generative AI tools has transformed how people engage with technology and highlighted how essential human qualities like critical thinking remain in academic and professional contexts. People across industries are learning to work effectively with AI systems—understanding when AI feedback is useful, when to maintain skepticism, and when human expertise proves irreplaceable.</p>
      <p>We hope this tool not only assists you with research projects but also provides a valuable opportunity to develop nuanced understanding of how generative AI works and how to maintain appropriate critical distance while benefiting from its capabilities. We believe that learning to extract value from AI while preserving your intellectual independence will serve you well beyond this program—these skills will likely become increasingly important across many professional contexts.</p>
      <p>We envision this as training for working effectively in an AI-integrated world, where the key isn't avoiding these technologies but learning to use them strategically while maintaining the distinctly human skills that AI cannot replicate.</p>

      <h2 class="text-xl font-semibold mt-4">The Bottom Line</h2>
      <p>We decided to create this tool because we saw an opportunity to harness emerging technology for genuine educational benefit—providing round-the-clock feedback that democratizes access to detailed academic support regardless of students' prior AI experience. This approach allows us to help you catch fundamental requirement issues early and avoid unproductive research directions, while scaling personalized guidance in ways that human resources alone cannot achieve. AI's ability to adapt to individual inputs and provide specific feedback represents something genuinely innovative in academic support, and we believe it offers tremendous value when used appropriately.</p>
      <p>However, it is important to remember that the goal isn't to satisfy an AI system—it's to help ensure you're developing research that serves <em>your</em> intellectual goals while aligning with sound methodological principles. We want to help you focus your energy on the original thinking and rigorous analysis that define excellent research, rather than working in directions that won't ultimately serve your research objectives.</p>
      <p>We have invested significant effort in making this tool as useful as possible, but we remain fully aware of its limitations. That's why we consider it crucial to communicate these considerations clearly—we hope this foundation will help you approach the tool strategically and extract genuine value from the support it can provide.</p>
    </div>
  </div>

  <script>
    const modeSelect = document.getElementById('modeSelect');
    const sections   = {
      rq: document.getElementById('rq-section'),
      relevance: document.getElementById('relevance-section'),
      'lit-structure': document.getElementById('lit-structure-section'),
      'literature-review': document.getElementById('literature-review-section'),
      'analytical-framework': document.getElementById('analytical-framework-section'),
      'formal-aspects': document.getElementById('formal-aspects-section')
    };
      const resultDiv  = document.getElementById('result');
      const copyBtn    = document.getElementById('copy-btn');
      const statusMsg  = document.getElementById('status-msg');
      let statusTimeout;
    const infoBtn    = document.getElementById('info-btn');
    const infoOverlay= document.getElementById('info-overlay');
    const infoClose  = document.getElementById('info-close');
    infoBtn.addEventListener('click', () => infoOverlay.classList.remove('hidden'));
    infoClose.addEventListener('click', () => infoOverlay.classList.add('hidden'));

    const titleLabel = document.getElementById('title-label');
    function updateTitleLabel(){
      const type = document.querySelector('input[name="project-type"]:checked').value;
      titleLabel.textContent = type === 'term' ? 'Title of the Term Paper' : 'Title of the Thesis';
    }
    document.querySelectorAll('input[name="project-type"]').forEach(r=>r.addEventListener('change', updateTitleLabel));
    updateTitleLabel();

    // Toggle LR and AF input modes
    const lrTextFields = document.getElementById('literature-review-textfields');
    const lrReminder   = document.getElementById('literature-review-file-reminder');
    document.querySelectorAll('input[name="lr-input-mode"]').forEach(r=>r.addEventListener('change',()=>{
      const fileMode = document.querySelector('input[name="lr-input-mode"]:checked').value === 'file';
      lrTextFields.classList.toggle('hidden', fileMode);
      lrReminder.classList.toggle('hidden', !fileMode);
    }));
    const afTextFields = document.getElementById('analytical-framework-textfields');
    const afReminder   = document.getElementById('analytical-framework-file-reminder');
    document.querySelectorAll('input[name="af-input-mode"]').forEach(r=>r.addEventListener('change',()=>{
      const fileMode = document.querySelector('input[name="af-input-mode"]:checked').value === 'file';
      afTextFields.classList.toggle('hidden', fileMode);
      afReminder.classList.toggle('hidden', !fileMode);
    }));

    // Set initial state for input mode toggles
    const lrFileInitial = document.querySelector('input[name="lr-input-mode"]:checked').value === 'file';
    lrTextFields.classList.toggle('hidden', lrFileInitial);
    lrReminder.classList.toggle('hidden', !lrFileInitial);
    const afFileInitial = document.querySelector('input[name="af-input-mode"]:checked').value === 'file';
    afTextFields.classList.toggle('hidden', afFileInitial);
    afReminder.classList.toggle('hidden', !afFileInitial);

    async function loadTemplate(name){
      const resp = await fetch(`prompts/${name}.txt`);
      return resp.text();
    }
    function fillTemplate(tmpl,data){
      return tmpl.replace(/{{(\w+)}}/g, (_, k) => data[k] || "");
    }

    function buildStudentInput(mode,data){
      let parts = [];
      if(mode==='rq' || mode==='rq-term-paper'){
        parts.push('<ProposedTitle>');
        parts.push(data.title || '');
        parts.push('</ProposedTitle>');
        parts.push('');
        parts.push('<ResearchQuestion>');
        parts.push(data.question || '');
        parts.push('</ResearchQuestion>');
      } else if(mode==='relevance'){
        parts.push('<ResearchQuestion>');
        parts.push(data.question || '');
        parts.push('</ResearchQuestion>');
        (data.stakeholders || []).forEach((it,i)=>{
          const n=i+1;
          parts.push('');
          parts.push(`<Stakeholder${n}>`);
          parts.push(it.name || '');
          parts.push(`</Stakeholder${n}>`);
          parts.push('');
          parts.push(`<Interest${n}>`);
          parts.push(it.reasons || '');
          parts.push(`</Interest${n}>`);
          parts.push('');
          parts.push(`<Arguments${n}>`);
          parts.push(it.arguments || '');
          parts.push(`</Arguments${n}>`);
        });
      } else if(mode==='lit-structure'){
        parts.push('<ResearchQuestion>');
        parts.push(data.researchQuestion || '');
        parts.push('</ResearchQuestion>');
        (data.issues || []).forEach((it,i)=>{
          const n=i+1;
          parts.push('');
          parts.push(`<Issue${n}Title>`);
          parts.push(it.title || '');
          parts.push(`</Issue${n}Title>`);
          parts.push('');
          parts.push(`<Issue${n}Explanation>`);
          parts.push(it.expl || '');
          parts.push(`</Issue${n}Explanation>`);
        });
      } else if(mode==='literature-review'){
        parts.push('<ResearchQuestion>');
        parts.push(data.question || '');
        parts.push('</ResearchQuestion>');
        parts.push('');
        parts.push('<LiteratureReview>');
        parts.push(data.review || '');
        parts.push('</LiteratureReview>');
      } else if(mode==='literature-review-file'){
        parts.push('<ResearchQuestion>');
        parts.push(data.question || '');
        parts.push('</ResearchQuestion>');
      } else if(mode==='analytical-framework'){
        parts.push('<ResearchQuestion>');
        parts.push(data.question || '');
        parts.push('</ResearchQuestion>');
        parts.push('');
        parts.push('<LiteratureReview>');
        parts.push(data.literature_review || '');
        parts.push('</LiteratureReview>');
        parts.push('');
        parts.push('<AnalyticalFramework>');
        parts.push(data.framework || '');
        parts.push('</AnalyticalFramework>');
      } else if(mode==='analytical-framework-file'){
        parts.push('<ResearchQuestion>');
        parts.push(data.question || '');
        parts.push('</ResearchQuestion>');
      }
      return ['<!-- ===== STUDENT INPUT ===== -->','',...parts].join('\n');
    }

    // Lit-structure controls
    const issuesDiv      = document.getElementById('lit-structure-issues');
    const addIssueBtn    = document.getElementById('add-issue-btn');
    const removeIssueBtn = document.getElementById('remove-issue-btn');

    // Relevance stakeholder controls
    const stakeholdersDiv      = document.getElementById('relevance-stakeholders');
    const addStakeholderBtn    = document.getElementById('add-stakeholder-btn');
    const removeStakeholderBtn = document.getElementById('remove-stakeholder-btn');

    function showSection(key) {
      Object.entries(sections).forEach(([k,el])=> el.classList.toggle('hidden', k!==key));
      resultDiv.textContent='';
      resultDiv.classList.add('hidden');
      copyBtn.classList.add('hidden');
    }
    modeSelect.addEventListener('change', ()=> showSection(modeSelect.value));
    showSection(modeSelect.value);

    // Counters
    [['title',500],['research-question',500],['relevance-rq',500],['lit-structure-rq',500],['literature-review-rq',500],['literature-review',50000],['analytical-framework-rq',500],['analytical-framework-lit-review',50000],['analytical-framework',50000]].forEach(([id,max])=>{
      const el=document.getElementById(id), cnt=document.getElementById(id+'-count');
      if(el&&cnt) el.addEventListener('input',()=>cnt.textContent = `${el.value.length} / ${max}`);
    });

    // Lit-Structure add/remove
    function updateRemoveBtn(){ removeIssueBtn.classList.toggle('hidden', issuesDiv.children.length <=3); }
    function renumberIssues(){ Array.from(issuesDiv.children).forEach((w,i)=>{ w.querySelector('label:nth-of-type(1)').textContent = `Issue ${i+1}: Title`; w.querySelector('label:nth-of-type(2)').textContent = `Issue ${i+1}: Explanation / Purpose`; }); }
    function addIssue(){ const num = issuesDiv.children.length+1; const w=document.createElement('div'); w.className='space-y-2 border-t pt-4'; const l1=document.createElement('label');l1.className='block font-medium';l1.textContent=`Issue ${num}: Title`; const i1=document.createElement('input');i1.type='text';i1.maxLength=500; i1.required=true; i1.className='w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500'; const c1=document.createElement('div');c1.className='text-xs text-gray-500';c1.textContent='0 / 500';i1.addEventListener('input',()=>c1.textContent=`${i1.value.length} / ${i1.maxLength}`); const l2=document.createElement('label');l2.className='block font-medium';l2.textContent=`Issue ${num}: Explanation / Purpose`; const i2=document.createElement('textarea');i2.rows=4;i2.maxLength=5000;i2.required=true;i2.className='w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500'; const c2=document.createElement('div');c2.className='text-xs text-gray-500';c2.textContent='0 / 5000';i2.addEventListener('input',()=>c2.textContent=`${i2.value.length} / ${i2.maxLength}`); w.append(l1,i1,c1,l2,i2,c2); issuesDiv.appendChild(w); updateRemoveBtn(); }
    function removeIssue(){ if(issuesDiv.children.length>3){ issuesDiv.removeChild(issuesDiv.lastChild); renumberIssues(); updateRemoveBtn(); }}
    addIssueBtn.addEventListener('click', addIssue);
    removeIssueBtn.addEventListener('click', removeIssue);
    for(let i=0;i<3;i++) addIssue();

    // Relevance stakeholder add/remove
    function updateStakeholderRemoveBtn(){ removeStakeholderBtn.classList.toggle('hidden', stakeholdersDiv.children.length <=3); }
    function renumberStakeholders(){
      Array.from(stakeholdersDiv.children).forEach((w,i)=>{
        w.querySelector('label:nth-of-type(1)').textContent = `Stakeholder ${i+1}`;
      });
    }
    function addStakeholder(){
      const num = stakeholdersDiv.children.length+1;
      const w = document.createElement('div');
      w.className = 'space-y-2 border-t pt-4';
      const l1 = document.createElement('label'); l1.className='block font-medium'; l1.textContent=`Stakeholder ${num}`;
      const i1 = document.createElement('input'); i1.type='text'; i1.maxLength=500; i1.className='w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500';
      const c1 = document.createElement('div'); c1.className='text-xs text-gray-500'; c1.textContent='0 / 500';
      i1.addEventListener('input',()=>c1.textContent=`${i1.value.length} / ${i1.maxLength}`);
      const l2 = document.createElement('label'); l2.className='block font-medium'; l2.textContent='Reasons why they would be interested in the research findings';
      const t1 = document.createElement('textarea'); t1.rows=3; t1.maxLength=5000; t1.className='w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500';
      const c2 = document.createElement('div'); c2.className='text-xs text-gray-500'; c2.textContent='0 / 5000';
      t1.addEventListener('input',()=>c2.textContent=`${t1.value.length} / ${t1.maxLength}`);
      const l3 = document.createElement('label'); l3.className='block font-medium'; l3.textContent='Arguments (data, quotes, references)';
      const t2 = document.createElement('textarea'); t2.rows=3; t2.maxLength=5000; t2.className='w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500';
      const c3 = document.createElement('div'); c3.className='text-xs text-gray-500'; c3.textContent='0 / 5000';
      t2.addEventListener('input',()=>c3.textContent=`${t2.value.length} / ${t2.maxLength}`);
      w.append(l1,i1,c1,l2,t1,c2,l3,t2,c3);
      stakeholdersDiv.appendChild(w);
      updateStakeholderRemoveBtn();
    }
    function removeStakeholder(){
      if(stakeholdersDiv.children.length>3){
        stakeholdersDiv.removeChild(stakeholdersDiv.lastChild);
        renumberStakeholders();
        updateStakeholderRemoveBtn();
      }
    }
    addStakeholderBtn.addEventListener('click', addStakeholder);
    removeStakeholderBtn.addEventListener('click', removeStakeholder);
    for(let i=0;i<3;i++) addStakeholder();

    // Generate prompt
    document.getElementById('submit-btn').addEventListener('click', async () => {
      let mode = modeSelect.value;
      const data = {};
      if(mode==='rq'){
        data.title=document.getElementById('title').value.trim();
        data.question=document.getElementById('research-question').value.trim();
        data.type=document.querySelector('input[name="project-type"]:checked').value;
        if(!data.title || !data.question){
          alert('Please provide information in all fields.');
          return;
        }
        mode = data.type==='term' ? 'rq-term-paper' : 'rq';
      } else if(mode==='relevance'){
        data.question=document.getElementById('relevance-rq').value.trim();
        if(!data.question){
          alert('Please provide the research question and at least one stakeholder.');
          return;
        }
        const rawItems = Array.from(stakeholdersDiv.children).map(w=>{
          const t = w.querySelectorAll('textarea');
          return {
            name: w.querySelector('input').value.trim(),
            reasons: t[0].value.trim(),
            arguments: t[1].value.trim()
          };
        });
        for(let i=0;i<rawItems.length;i++){
          const {name,reasons,arguments:args}=rawItems[i];
          const filled = [name,reasons,args].filter(x=>x);
          if(filled.length>0 && filled.length<3){
            alert(`Stakeholder ${i+1}: please fill out all fields or clear them.`);
            return;
          }
        }
        const items = rawItems.filter(it=>it.name||it.reasons||it.arguments);
        if(items.length===0){
          alert('Please provide the research question and at least one stakeholder.');
          return;
        }
        data.stakeholders = items;
      } else if(mode==='lit-structure'){
        data.researchQuestion=document.getElementById('lit-structure-rq').value.trim();
        if(!data.researchQuestion){
          alert('Please provide the research question and at least one issue.');
          return;
        }
        const rawItems=Array.from(issuesDiv.children).map(w=>({title:w.querySelector('input').value.trim(), expl:w.querySelector('textarea').value.trim()}));
        for(let i=0;i<rawItems.length;i++){
          const {title,expl}=rawItems[i];
          if((title && !expl) || (!title && expl)){
            alert(`Issue ${i+1}: please fill out both title and explanation or clear both fields.`);
            return;
          }
        }
        const items = rawItems.filter(it=>it.title||it.expl);
        if(items.length===0){
          alert('Please provide the research question and at least one issue.');
          return;
        }
        data.structure=items.map(({title,expl})=>`Issue: ${title}\nExplanation / Purpose: ${expl}`).join('\n\n');
        data.issues = items;
      } else if(mode==='literature-review'){
        const lrFile = document.querySelector('input[name="lr-input-mode"]:checked').value === 'file';
        data.question=document.getElementById('literature-review-rq').value.trim();
        if(lrFile){
          if(!data.question){
            alert('Please provide the research question.');
            return;
          }
          mode = 'literature-review-file';
        } else {
          data.review=document.getElementById('literature-review').value.trim();
          if(!data.question || !data.review){
            alert('Please provide information in all fields.');
            return;
          }
        }
      } else if(mode==='analytical-framework'){
        const afFile = document.querySelector('input[name="af-input-mode"]:checked').value === 'file';
        data.question=document.getElementById('analytical-framework-rq').value.trim();
        if(afFile){
          if(!data.question){
            alert('Please provide the research question.');
            return;
          }
          mode = 'analytical-framework-file';
        } else {
          data.literature_review=document.getElementById('analytical-framework-lit-review').value.trim();
          data.framework=document.getElementById('analytical-framework').value.trim();
          if(!data.question || !data.literature_review || !data.framework){
            alert('Please provide information in all fields.');
            return;
          }
        }
      } else if(mode==='formal-aspects'){
        // No additional data required
      }
      const tmpl = await loadTemplate(mode);
      const prompt = fillTemplate(tmpl, data) + '\n\n' + buildStudentInput(mode,data);
      resultDiv.classList.add('hidden');
      copyBtn.classList.add('hidden');
      setTimeout(()=>{
        resultDiv.textContent = prompt;
        resultDiv.classList.remove('hidden');
        copyBtn.classList.remove('hidden');
      },500);
      statusMsg.classList.remove('hidden');
      clearTimeout(statusTimeout);
      statusTimeout = setTimeout(()=>statusMsg.classList.add('hidden'), 1500);
    });
    copyBtn.addEventListener('click',()=>navigator.clipboard.writeText(resultDiv.textContent));
  </script>
</body>
</html>
