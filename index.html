<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EcoS Prompt-Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
  <div class="max-w-3xl mx-auto p-6 space-y-6">

    <h1 class="text-3xl font-bold">EcoS Prompt-Generator</h1>
    <p class="text-sm text-gray-700">
      <strong>Instructions:</strong><br>
      First choose what to generate, then pick a mode.  
      In Testing Mode you get a single input for rapid prototyping; in Official Mode you get the full form.<br>
      Click Submit to build your prompt.
    </p>

    <!-- Phase & Mode selectors -->
    <div class="space-y-4">
      <div>
        <label for="phaseSelect" class="block font-medium mb-1">What to generate</label>
        <select id="phaseSelect"
                class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500">
          <option value="rq">1. Topic &amp; Research Question</option>
          <option value="relevance">2. Relevance Table</option>
          <option value="lit-structure">3. Literature Review Structure</option>
          <option value="literature-review">4. Literature Review</option>
          <option value="analytical-framework">5. Analytical Framework</option>
        </select>
      </div>

      <div>
        <label for="phaseModeSelect" class="block font-medium mb-1">Mode</label>
        <select id="phaseModeSelect"
                class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500">
          <option value="official">Official</option>
          <option value="testing">Testing Mode</option>
        </select>
      </div>
    </div>

    <!-- Testing Mode: single textarea -->
    <div id="testing-section" class="hidden">
      <label for="testing-input" class="block font-medium mb-1">Testing Input</label>
      <textarea id="testing-input" rows="10"
                class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"
                placeholder="Paste all your test inputs here‚Ä¶"></textarea>
    </div>

    <!-- Official Mode: phase-specific forms -->
    <div id="official-section" class="space-y-6">

      <!-- 1. Topic & Research Question -->
      <div id="rq-section" class="space-y-4">
        <div>
          <label class="block font-medium">Title of the Thesis</label>
          <input id="title" type="text" maxlength="500"
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="title-count" class="text-xs text-gray-500">0 / 500</div>
        </div>
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="research-question" type="text" maxlength="500"
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="rq-count" class="text-xs text-gray-500">0 / 500</div>
        </div>
      </div>

      <!-- 2. Relevance Table -->
      <div id="relevance-section" class="space-y-4 hidden">
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="relevance-rq" type="text" maxlength="500"
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="relevance-rq-count" class="text-xs text-gray-500">0 / 500</div>
        </div>
        <div>
          <label class="block font-medium">Relevance Section</label>
          <textarea id="relevance" rows="6" maxlength="50000"
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="relevance-count" class="text-xs text-gray-500">0 / 50000</div>
        </div>
      </div>

      <!-- 3. Literature Review Structure -->
      <div id="lit-structure-section" class="space-y-4 hidden">
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="lit-structure-rq" type="text" maxlength="500"
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="lit-structure-rq-count" class="text-xs text-gray-500">0 / 500</div>
        </div>
        <div id="lit-structure-issues" class="space-y-6"></div>
        <div class="flex gap-2">
          <button id="add-issue-btn" type="button"
                  class="flex-1 bg-gray-200 p-2 rounded-xl hover:bg-gray-300">
            + Add issue
          </button>
          <button id="remove-issue-btn" type="button"
                  class="flex-1 bg-red-200 p-2 rounded-xl hover:bg-red-300">
            ‚Äì Remove last issue
          </button>
        </div>
      </div>

      <!-- 4. Literature Review -->
      <div id="literature-review-section" class="space-y-4 hidden">
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="literature-review-rq" type="text" maxlength="500"
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="literature-review-rq-count" class="text-xs text-gray-500">0 / 500</div>
        </div>
        <div>
          <label class="block font-medium">Literature Review Structure</label>
          <textarea id="literature-review-structure" rows="4" maxlength="50000"
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="literature-review-structure-count" class="text-xs text-gray-500">0 / 50000</div>
        </div>
        <div>
          <label class="block font-medium">Literature Review</label>
          <textarea id="literature-review" rows="6" maxlength="50000"
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="literature-review-count" class="text-xs text-gray-500">0 / 50000</div>
        </div>
      </div>

      <!-- 5. Analytical Framework -->
      <div id="analytical-framework-section" class="space-y-4 hidden">
        <div>
          <label class="block font-medium">Research Question</label>
          <input id="analytical-framework-rq" type="text" maxlength="500"
                 class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"/>
          <div id="analytical-framework-rq-count" class="text-xs text-gray-500">0 / 500</div>
        </div>
        <div>
          <label class="block font-medium">Literature Review</label>
          <textarea id="analytical-framework-lit-review" rows="4" maxlength="50000"
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="analytical-framework-lit-review-count" class="text-xs text-gray-500">0 / 50000</div>
        </div>
        <div>
          <label class="block font-medium">Analytical Framework</label>
          <textarea id="analytical-framework" rows="6" maxlength="50000"
                    class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500"></textarea>
          <div id="analytical-framework-count" class="text-xs text-gray-500">0 / 50000</div>
        </div>
      </div>

    </div>

    <!-- Submit & Output -->
    <div class="space-y-4">
      <button id="submit-btn"
              class="w-full bg-blue-600 text-white p-3 rounded-xl hover:bg-blue-700 transition">
        Submit
      </button>
      <div id="result" class="whitespace-pre-wrap bg-white p-4 border border-gray-300 rounded-xl text-sm"></div>
      <button id="copy-btn"
              class="w-full bg-green-600 text-white p-3 rounded-xl hover:bg-green-700 transition hidden">
        Copy to Clipboard
      </button>
    </div>

  </div>

  <script>
    // Elements
    const phaseSelect       = document.getElementById('phaseSelect');
    const phaseModeSelect   = document.getElementById('phaseModeSelect');
    const testingSection    = document.getElementById('testing-section');
    const officialSection   = document.getElementById('official-section');
    const testingInput      = document.getElementById('testing-input');

    const sections = {
      rq:                  document.getElementById('rq-section'),
      relevance:           document.getElementById('relevance-section'),
      'lit-structure':     document.getElementById('lit-structure-section'),
      'literature-review': document.getElementById('literature-review-section'),
      'analytical-framework': document.getElementById('analytical-framework-section'),
    };

    const resultDiv        = document.getElementById('result');
    const copyBtn          = document.getElementById('copy-btn');

    // Lit-structure controls
    const issuesDiv        = document.getElementById('lit-structure-issues');
    const addIssueBtn      = document.getElementById('add-issue-btn');
    const removeIssueBtn   = document.getElementById('remove-issue-btn');

    // Switch between Testing vs Official
    function updateInterface() {
      const isTesting = phaseModeSelect.value === 'testing';
      testingSection.classList.toggle('hidden', !isTesting);
      officialSection.classList.toggle('hidden', isTesting);
      resultDiv.textContent = '';
      copyBtn.classList.add('hidden');
    }
    phaseModeSelect.addEventListener('change', updateInterface);
    updateInterface();

    // Show only the selected phase in Official mode
    function updateSections() {
      Object.entries(sections).forEach(([key, el]) => {
        el.classList.toggle('hidden', phaseSelect.value !== key);
      });
      resultDiv.textContent = '';
      copyBtn.classList.add('hidden');
    }
    phaseSelect.addEventListener('change', updateSections);
    updateSections();

    // Character counters
    [
      ['title',500],['research-question',500],
      ['relevance-rq',500],['relevance',50000],
      ['lit-structure-rq',500],
      ['literature-review-rq',500],['literature-review-structure',50000],
      ['literature-review',50000],
      ['analytical-framework-rq',500],['analytical-framework-lit-review',50000],
      ['analytical-framework',50000]
    ].forEach(([id,max])=>{
      const el = document.getElementById(id);
      const cnt= document.getElementById(id+'-count');
      el.addEventListener('input',()=>cnt.textContent=`${el.value.length} / ${max}`);
    });

    // Lit-Structure: add/remove last issue
    function updateRemoveBtn() {
      removeIssueBtn.disabled = issuesDiv.children.length <= 3;
    }
    function addIssue() {
      const num = issuesDiv.children.length + 1;
      const w = document.createElement('div');
      w.className = 'space-y-2 border-t pt-4';

      // Title
      const l1 = document.createElement('label');
      l1.className = 'block font-medium';
      l1.textContent = `Issue ${num}: Title`;
      const i1 = document.createElement('input');
      i1.type='text'; i1.maxLength=500;
      i1.required=true;
      i1.className='w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500';
      const c1 = document.createElement('div');
      c1.className='text-xs text-gray-500'; c1.textContent='0 / 500';
      i1.addEventListener('input',()=>c1.textContent=`${i1.value.length} / ${i1.maxLength}`);

      // Explanation / Purpose
      const l2 = document.createElement('label');
      l2.className = 'block font-medium';
      l2.textContent = `Issue ${num}: Explanation / Purpose`;
      const i2 = document.createElement('textarea');
      i2.rows=4; i2.maxLength=5000; i2.required=true;
      i2.className='w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500';
      const c2 = document.createElement('div');
      c2.className='text-xs text-gray-500'; c2.textContent='0 / 5000';
      i2.addEventListener('input',()=>c2.textContent=`${i2.value.length} / ${i2.maxLength}`);

      w.append(l1,i1,c1,l2,i2,c2);
      issuesDiv.appendChild(w);
      updateRemoveBtn();
    }
    function removeIssue() {
      if(issuesDiv.children.length > 3) {
        issuesDiv.removeChild(issuesDiv.lastChild);
        updateRemoveBtn();
      }
    }
    addIssueBtn.addEventListener('click', addIssue);
    removeIssueBtn.addEventListener('click', removeIssue);
    // init 3 issues
    for(let i=0;i<3;i++) addIssue();

    // Submit: build prompt
    document.getElementById('submit-btn').addEventListener('click', ()=>{
      let prompt = '';
      if(phaseModeSelect.value==='testing') {
        prompt = testingInput.value;
      } else {
        const mode = phaseSelect.value;
        if(mode==='rq') {
          const t = document.getElementById('title').value.trim();
          const q = document.getElementById('research-question').value.trim();
          prompt = `EcoS Prompt-Generator: Research Question\n\nTitle: "${t}"\nResearch Question: "${q}"`;
        }
        else if(mode==='relevance') {
          const q = document.getElementById('relevance-rq').value.trim();
          const r = document.getElementById('relevance').value.trim();
          prompt = `EcoS Prompt-Generator: Relevance\n\nResearch Question: "${q}"\n\nRelevance Section:\n${r}`;
        }
        else if(mode==='lit-structure') {
          const rq = document.getElementById('lit-structure-rq').value.trim();
          const items = Array.from(issuesDiv.children).map(w=>{
            const t = w.querySelector('input').value.trim();
            const e = w.querySelector('textarea').value.trim();
            return `Issue: ${t}\nExplanation / Purpose: ${e}`;
          }).join('\n\n');
          prompt = `<PromptTemplate>
<!-- ===== ROLE ===== -->
<Role>
    You are acting as the professor‚Äôs assistant.
    Your sole job is to analyse students‚Äô proposed **Literature Review Structures (LRS)** and give them feedback *before* they submit to the professor.
</Role>

<!-- ===== PURPOSE ===== -->
<Background>
    The **Literature Review Structure (LRS)** is a planning tool.
    It helps students identify the conceptual fields, debates, and analytical tools they will need to review in the full Literature Review (LR).
    The LR will be a **systematic review of existing scholarly work**, used to build a foundation for the student's own **Analytical Framework (AF)**.
    The AF will be derived from the literature review and represent the student's own method for answering their research question in the empirical chapter.
</Background>

<!-- ===== INSTRUCTIONS ===== -->
<Instructions>
    1. Judge each LRS section only on whether it contributes directly to answering the **key analytical term** in the Research Question (RQ).
    2. The LRS should prepare the *how* (concepts, typologies, frameworks)‚Äî**not** the *why* (causes, drivers) or *what* (cases, results).
    3. If a section drifts into causal explanations, history, cases, or results, label it **Off-target**.
    4. Definitions are allowed only if concise (‚â§2‚Äì3 sentences); otherwise label **Adapt**.
    5. Keep tone supportive but academically precise; remind student professor has final say.
</Instructions>

<!-- ===== TAGS ===== -->
<Tags>
    ‚úÖ On-target ‚Äì supports the key analytical term.  
    ‚ö†Ô∏è Off-target ‚Äì should be cut or moved.  
    üõ†Ô∏è Adapt ‚Äì needs refocusing or shortening.  
    üß© Suggestion ‚Äì optional improvement.
</Tags>

<!-- ===== EXPECTED OUTPUT ===== -->
<ExpectedOutput>
    For **each** LRS section:
    ‚Ä¢ Tag + one-sentence verdict + 1‚Äì3 sentence justification + reminder professor decides.
</ExpectedOutput>

<!-- ===== REVIEW CRITERIA ===== -->
<ReviewCriteria>
    1. Addresses the RQ‚Äôs key analytical term?  
    2. Avoids causal, historical, or case-specific content?  
    3. Thematically organized (not timeline/author)?  
    4. Shows synthesis (not summary)?  
    5. Builds toward an AF for empirical work?
</ReviewCriteria>

<!-- ===== STUDENT INPUT ===== -->
<ResearchQuestion>
    ${rq}
</ResearchQuestion>

<LiteratureReview>
${items.split('\n').map(l=>'    '+l).join('\n')}
</LiteratureReview>
</PromptTemplate>`;
        }
        else if(mode==='literature-review') {
          const q = document.getElementById('literature-review-rq').value.trim();
          const s = document.getElementById('literature-review-structure').value.trim();
          const r = document.getElementById('literature-review').value.trim();
          prompt = `EcoS Prompt-Generator: Literature Review\n\nResearch Question: "${q}"\n\nStructure:\n${s}\n\nReview:\n${r}`;
        }
        else if(mode==='analytical-framework') {
          const q  = document.getElementById('analytical-framework-rq').value.trim();
          const lr = document.getElementById('analytical-framework-lit-review').value.trim();
          const af = document.getElementById('analytical-framework').value.trim();
          prompt = `EcoS Prompt-Generator: Analytical Framework\n\nResearch Question: "${q}"\n\nLiterature Review:\n${lr}\n\nAnalytical Framework:\n${af}`;
        }
      }
      resultDiv.textContent = prompt;
      copyBtn.classList.remove('hidden');
    });

    // Copy to clipboard
    copyBtn.addEventListener('click', ()=>{
      navigator.clipboard.writeText(resultDiv.textContent)
        .then(()=>copyBtn.textContent='Copied!')
        .catch(()=>copyBtn.textContent='Copy Failed');
    });
  </script>
</body>
</html>
